<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>222Diamond</title>
    <link type="text/css" rel="stylesheet" href="style.css" />
    <script type="text/javascript">
        var credito = 0;
        var aposta = 1;
        var diamantesSelecionados = [];

        // Função para verificar se o usuário está logado
        function verificarLogin() {
            var usuarioLogado = localStorage.getItem('usuarioLogado');
            if (!usuarioLogado) {
                window.location.href = 'index.html'; // Redireciona se não houver usuário logado
            } else {
                // Se o usuário estiver logado, carregar seus créditos
                credito = parseInt(localStorage.getItem(usuarioLogado)) || 0;
                document.getElementById('credito').value = 'R$ ' + credito;
            }
        }

        function apostaMenos() {
            if (aposta > 1) {
                aposta--;
                document.getElementById('aposta').value = 'R$ ' + aposta;
            }
        }

        function apostaMais() {
            if (aposta < 500) {
                aposta++;
                document.getElementById('aposta').value = 'R$ ' + aposta;
            }
        }

        function selecionarDiamante(diamante) {
            var index = diamantesSelecionados.indexOf(diamante);
            if (index !== -1) {
                diamantesSelecionados.splice(index, 1); // Remove se já estiver selecionado
            } else {
                if (diamantesSelecionados.length < 4) { // Limita a 4 seleções
                    diamantesSelecionados.push(diamante);
                }
            }
            document.getElementById('resultadoSelecionados').innerText = "Aposte em: " + diamantesSelecionados.join(', ');
        }

        function jogar() {
            if (credito < 1 || credito < aposta) {
                var aux = window.prompt("Coloque mais créditos, digite a quantidade em R$:", "1");
                aux = parseInt(aux);
                credito = parseInt(credito);
                credito += aux;
                document.getElementById('credito').value = 'R$ ' + credito;
                localStorage.setItem(localStorage.getItem('usuarioLogado'), credito); // Atualiza créditos no localStorage
            } else {
                if (credito > 0 && credito >= aposta) {
                    credito -= aposta;
                    document.getElementById('credito').value = 'R$ ' + credito;

                    // Gira os slots
                    for (var i = 1; i <= 4; i++) {
                        var resultado = aleatorio(1, 5); // Gera número entre 1 e 4
                        document.getElementById("escud" + i).src = "img/diamante_" + ["verde", "rosa", "mesclado", "cifrao"][resultado - 1] + ".png";
                    }

                    // Verifica o resultado
                    verificarResultado();
                }
            }
        }

        function verificarResultado() {
            var resultados = [];
            for (var i = 1; i <= 4; i++) {
                var imgSrc = document.getElementById("escud" + i).src;
                resultados.push(imgSrc.substring(imgSrc.lastIndexOf('/') + 1, imgSrc.lastIndexOf('.png')));
            }
            var vitoria = diamantesSelecionados.some(diamante => resultados.includes("diamante_" + diamante + ".png") || diamante === "cifrao.png");
            if (vitoria) {
                alert("Você ganhou!"); // Notifica o jogador
                // Aqui você pode implementar a lógica de premios baseada no resultado (você pode ajustar conforme sua tabela de prêmio)
            } else {
                alert("Você perdeu. Tente novamente!");
            }
            diamantesSelecionados = []; // Reseta as seleções
            document.getElementById('resultadoSelecionados').innerText = "";
        }

        function aleatorio(inferior, superior) {
            var numPossibilidades = superior - inferior;
            var aleat = Math.random() * numPossibilidades;
            aleat = Math.floor(aleat);
            return parseInt(inferior) + aleat;
        }

        // Chama verificarLogin ao carregar a página
        window.onload = verificarLogin;
    </script>
</head>
<body>
    <div id="corpo">
        <div id="creditos_txt">Saldo</div>
        <div id="creditos">
            <form>
                <input id="credito" type="text" size="5" value="R$ 0" readonly />
            </form>
        </div>

        <div id="valor_txt">Valor da Aposta</div>
        <div id="valor">
            <form>
                <input id="aposta" type="text" size="1" value="R$ 1" readonly />
            </form>
        </div>

        <div id="tela">
            <div id="slot1" onclick="selecionarDiamante('verde');"><img id="escud1" src="img/diamante_verde.png" /></div>
            <div id="slot2" onclick="selecionarDiamante('mesclado');"><img id="escud2" src="img/diamante_mesclado.png" /></div>
            <div id="slot3" onclick="selecionarDiamante('rosa');"><img id="escud3" src="img/diamante_rosa.png" /></div>
            <div id="slot4" onclick="selecionarDiamante('cifrao');"><img id="escud4" src="img/cifrao.png" /></div>
        </div>

        <div id="resultadoSelecionados"></div>

        <div id="botoes">
            <img src="img/apostamenos.gif" onclick="apostaMenos();" />
            <img src="img/apostamais.gif" onclick="apostaMais();" />
            <img src="img/jogar.gif" onclick="jogar();" />
        </div>

        <div id="rodapé">
            <a href="tabela.html" target='_blank'>Clique aqui para ver a Tabela de prêmios que você poderá ganhar neste jogo!</a>
        </div>
    </div>
</body>
</html>
